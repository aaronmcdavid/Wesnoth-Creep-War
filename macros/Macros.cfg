{~add-ons/Creep_War/shop/shop.cfg}
#define CW_SET_GOLD SIDE GOLD
	[modify_side]
		side={SIDE}
		gold={GOLD}
	[/modify_side]
#enddef

#define update_score
		[print]
			text="$killwest| : $killeast|"
			size=24
			red=255
			duration=110
		[/print]
		[label]
			x=18
			y=9
			text="

$killwest| : $killeast|"
		[/label]
		[label]
			x=18
			y=10
			text="$gold_W|g : $gold_E|g"
		[/label]
#enddef

#define Advance_To
	[store_unit]
		[filter]
			canrecruit=yes
		[/filter]
		variable=units
	[/store_unit]
	{FOREACH units i}
		[set_variable]
			name=units[$i].variables.advance
			value=$units[$i].advances_to
		[/set_variable]
		[set_variables]
			name=tmp
			mode=replace
			[split]
				list=$units[$i].variables.advance|
				key=item
				separator=","
			[/split]
		[/set_variables]
		[set_variable]
			name=units[$i].variables.num_advance
			value=$tmp.length
		[/set_variable]
		[unstore_unit]
			variable=units[$i]
		[/unstore_unit]
	{NEXT i}
	[unstore_unit]
		variable=units
	[/unstore_unit]
	[set_menu_item]
		id=Badvanceto
		description= _ "Advance toâ€¦"
		[show_if]
			[have_unit]
				side=$side_number
				canrecruit=yes
				x=$x1
				y=$y1
			[/have_unit]
			[variable]
				name=unit.variables.num_advance
				greater_than_equal_to=2
			[/variable]
		[/show_if]
		[command]
			[set_variables]
				name=advance
				mode=replace
				[split]
					list=$unit.variables.advance|
					key=item
					separator=","
				[/split]
			[/set_variables]
			{FOREACH advance i}
				[unit]
					type=$advance[$i].item
					to_variable=unit_type_$i|
				[/unit]
			{NEXT i}
			[message]
				speaker=unit
				message= _ "This unit is set to advance to: $unit.advances_to|"
				[option]
					message= _ "back"
				[/option]
				[option]
					message= _ {MENU_IMG_TXT $unit_type_0.image| "$advance[0].item|"}
					[show_if]
						[variable]
							name=advance.length
							greater_than_equal_to=1
						[/variable]
					[/show_if]
					[command]
						[set_variable]
							name=unit.advances_to
							value=$advance[0].item|
						[/set_variable]
						[unstore_unit]
							variable=unit
						[/unstore_unit]
					[/command]
				[/option]
				[option]
					message= _ {MENU_IMG_TXT $unit_type_1.image| "$advance[1].item|"}
					[show_if]
						[variable]
							name=advance.length
							greater_than_equal_to=2
						[/variable]
					[/show_if]
					[command]
						[set_variable]
							name=unit.advances_to
							value=$advance[1].item|
						[/set_variable]
						[unstore_unit]
							variable=unit
						[/unstore_unit]
					[/command]
				[/option]
				[option]
					message= _ {MENU_IMG_TXT $unit_type_2.image| "$advance[2].item|"}
					[show_if]
						[variable]
							name=advance.length
							greater_than_equal_to=3
						[/variable]
					[/show_if]
					[command]
						[set_variable]
							name=unit.advances_to
							value=$advance[2].item|
						[/set_variable]
						[unstore_unit]
							variable=unit
						[/unstore_unit]
					[/command]
				[/option]
#				[option]
#					message= _ "I don't want to advance (AMLA)"
#					[command]
#						[set_variable]
#							name=unit.advances_to
#							value=null
#						[/set_variable]
#						[unstore_unit]
#							variable=unit
#						[/unstore_unit]
#					[/command]
#				[/option]
				[option]
					message= _ "I want to choose later"
					[command]
						[set_variable]
							name=unit.advances_to
							value=$unit.variables.advance
						[/set_variable]
						[unstore_unit]
							variable=unit
						[/unstore_unit]
					[/command]
				[/option]
			[/message]
		[/command]
	[/set_menu_item]
#enddef

#define Post_Advance
	[event]
		name=post advance
		first_time_only=no
		[clear_variable]
			name=unit.variables.advance
		[/clear_variable]
		{VARIABLE unit.variables.advance $unit.advances_to|}
		[set_variables]
			name=tmp
			mode=replace
			[split]
				list=$unit.variables.advance|
				key=item
				separator=","
			[/split]
		[/set_variables]
		[set_variable]
			name=unit.variables.num_advance
			value=$tmp.length
		[/set_variable]
		[unstore_unit]
			variable=unit
			find_vacant=no
		[/unstore_unit]
	[/event]
#enddef

#define teleport x y side
	[event]
		name=side turn
		first_time_only=no
		[if]
			[variable]
				name=side_number
				equals={side}
			[/variable]
			[then]
				[if]
					[variable]
						name=hero_{side}
						equals=on_start_pos
					[/variable]
					[then]
						[teleport]
							[filter]
								side={side}
								canrecruit=yes
							[/filter]
							x={x}
							y={y}
						[/teleport]
						[set_variable]
							name=hero_{side}
							value=alive
						[/set_variable]
					[/then]
				[/if]
				[if]
					[variable]
						name=hero_{side}
						equals=dead
					[/variable]
					[then]
						[unstore_unit]
							variable=dead_hero_{side}
							x={x}
							y={y}
							find_vacant=yes
						[/unstore_unit]
						[set_variable]
							name=hero_{side}
							value=alive
						[/set_variable]
					[/then]
				[/if]
				[if]
					[variable]
						name=hero_{side}
						equals=dead_wait
					[/variable]
					[then]
						[set_variable]
							name=hero_{side}
							value=dead
						[/set_variable]
					[/then]
				[/if]
			[/then]
		[/if]
	[/event]
#enddef
#define hero_die enemy1 enemy2 enemy3 x y kill team side
	[event]
		name=die
		first_time_only=no
		[filter]
			side={side}
			canrecruit=yes
		[/filter]
		[object]
			silent=yes
			[effect]
				apply_to=hitpoints
				heal_full=yes
			[/effect]
			[effect]
				apply_to=status
				remove=poisoned
			[/effect]
			[effect]
				apply_to=status
				remove=slowed
			[/effect]
		[/object]
		[gold]
			side={enemy1}
			amount=20
		[/gold]
		[gold]
			side={enemy2}
			amount=20
		[/gold]
		[gold]
			side={enemy3}
			amount=20
		[/gold]
		[set_variable]
			name=gold_{team}
			add=20
		[/set_variable]
		[store_unit]
			[filter]
				side={side}
				canrecruit=yes
			[/filter]
			variable=dead_hero_{side}
			kill=yes
		[/store_unit]
		[set_variable]
			name={kill}
			add=3
		[/set_variable]
		[set_variable]
			name=hero_{side}
			value=dead_wait
		[/set_variable]
		[object]
			silent=yes
			[filter]
				id=CW_Guard_{team}1
			[/filter]
			[effect]
				apply_to=hitpoints
				increase_total=3
				increase=3
			[/effect]
		[/object]
		[object]
			silent=yes
			[filter]
				id=CW_Guard_{team}2
			[/filter]
			[effect]
				apply_to=hitpoints
				increase_total=3
				increase=3
			[/effect]
		[/object]
		[set_variable]
			name=guard_{team}_plus_hitpoints
			add=3
		[/set_variable]
		{update_score}
	[/event]
#enddef
#define teleport_back_MI x y side
	[set_menu_item]
		id=Teleport{side}
		description= _ "Telelport in game"
		[filter_location]
			y=2
		[/filter_location]
		[show_if]
			[have_unit]
				side={side}
				canrecruit=yes
				x=$x1
				y=$y1
			[/have_unit]
			[variable]
				name=side_number
				equals={side}
			[/variable]
		[/show_if]
		[command]
			[if]
				[variable]
					name=hero_{side}
					equals=on_start_pos
				[/variable]
				[then]
					[teleport]
						[filter]
							side={side}
							canrecruit=yes
						[/filter]
						x={x}
						y={y}
					[/teleport]
					[set_variable]
						name=hero_{side}
						value=alive
					[/set_variable]
				[/then]
			[/if]
		[/command]
	[/set_menu_item]
#enddef
#define no_shield_attack
	[event]
		name=attack
		first_time_only=no
		[if]
			[variable]
				name=have_weapon_$side_number|_15
				equals=yes
			[/variable]
			[then]
				[object]
					silent=yes
					[effect]
						apply_to=remove_attacks
						name=shield_melee
					[/effect]
					[effect]
						apply_to=remove_attacks
						name=shield_ranged
					[/effect]
				[/object]
			[/then]
		[/if]
	[/event]
	[event]
		name=attack end
		first_time_only=no
		[if]
			[variable]
				name=have_weapon_$side_number|_15
				equals=yes
			[/variable]
			[then]
				[object]
					silent=yes
					[effect]
						apply_to=new_attack
						name=shield_melee
						description= _ "shield"
						[specials]
							{shield_30}
						[/specials]
						icon=icons/shield_tower_merfolk.png
						range=melee
						type=none
						damage=0
						number=0
					[/effect]
					[effect]
						apply_to=new_attack
						name=shield_ranged
						description= _ "shield"
						[specials]
							{shield_30}
						[/specials]
						icon=icons/shield_tower_merfolk.png
						range=ranged
						type=none
						damage=0
						number=0
					[/effect]
				[/object]
			[/then]
		[/if]
	[/event]
#enddef

#define Bank_interest
	[event]
		name=side turn
		first_time_only=no
		[set_variable]
			name=bank_$side_number
			multiply=1.025
		[/set_variable]
	[/event]
#enddef

#define Enable_Ancient_Lich
	[event]
		name=post advance
		first_time_only=no
		[filter]
			type=Lich
		[/filter]
		{VARIABLE unit.advances_to "Ancient Lich"}
		[unstore_unit]
			variable=unit
			find_vacant=no
		[/unstore_unit]
	[/event]
#enddef

#define CW_HUMAN_PLAYER_SETTINGS TEAM SIDE PLAYERNUM
	[side]
		description={TEAM} Player {PLAYERNUM}
		side={SIDE}
		team_name={TEAM}
		canrecruit=yes
		controller=human
		gold=100
		income=-2
		team_lock=yes
		gold_lock=yes
		income_lock=yes
		share_view=yes
	[/side]
#enddef

#define CW_CREEP_PLAYER_SETTINGS TEAM SIDE
	[side]
		description={TEAM} Creeps
		side={SIDE}
		team_name={TEAM}
		controller=ai
		gold=100
		income=-2
		allow_player=no
		team_lock=yes
		gold_lock=yes
		income_lock=yes
		share_view=yes
		canrecruit=yes
		[ai]
			aggression=0.9
			caution=0.0
			village_value=0.0
#ifdef CW_USE_MAIN_MAP
			leader_value=3.0
			[avoid]
				x=8,8,28,28,11,11,11,11,25,25,25,25
				y=9,11,9,11,9,10,11,12,9,10,11,12
			[/avoid]
#endif
#ifdef CW_USE_ALTERNATE_MAP
			leader_value=5.0
			[avoid]
				x=8,8,28,28
				y=9,11,9,11
			[/avoid]
#endif
#ifdef CW_USE_THREE_TEAM
			leader_value=5.0
			[avoid]
				x=7,5,27,29,15,19
				y=8,11,8,11,26,26
			[/avoid]
#endif
		[/ai]
	[/side]
#enddef

#define CW_ADD_SHOP_TO_MAP X_POS Y_POS
	[item]
		x={X_POS}
		y={Y_POS}
		image=terrain/castle/encampment/tent.png
	[/item]
		[label]
		x={X_POS}
		y={Y_POS}
		text=Shop
	[/label]
#enddef