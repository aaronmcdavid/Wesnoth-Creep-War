{~add-ons/Creep_War/macros/Macros.cfg}
#ifdef CW_USE_THREE_TEAMS

#define CW_UPDATE_SCORE
	[print]
		text="$cw_kills_West| : $cw_kills_South| : $cw_kills_East|"
		size=24
		red=255
		duration=110
	[/print]
	{CW_MAP_DISPLAY_SCORE}
#enddef

#define CW_MAP_DISPLAY_SCORE
	[label]
		x=16
		y=14
		text="$cw_kills_West|
$gold_West|g"
		[/label]
	[label]
		x=18
		y=14
		text="$cw_kills_East|
$gold_East|g"
		[/label]
	[label]
		x=17
		y=15
		text="$cw_kills_South|
$gold_South|g"
		[/label]
#enddef

#define frac_add_hp_guard kill team
	{VARIABLE_OP {kill}_frac add 0.5}
	[if]
		{VARIABLE_CONDITIONAL {kill}_frac greater_than_equal_to 1}
		[then]
			{VARIABLE_OP {kill}_frac sub 1}
			[object]
				silent=yes
				[filter]
					id=CW_Guard_{team}1
					[/filter]
				{CW_EFFECT_HITPOINTS 1}
				[/object]
			[object]
				silent=yes
				[filter]
					id=CW_Guard_{team}2
					[/filter]
				{CW_EFFECT_HITPOINTS 1}
				[/object]
			{VARIABLE_OP guard_{team}_plus_hitpoints add 1}
			[/then]
		[/if]
#enddef

#define CW_EVENT_HERO_DIE_3 enemy1 enemy2 creepside1 enemy3 enemy4 creepside2 kill1 team1 kill2 team2 side
	[event]
		name=die
		first_time_only=no
		[filter]
			side={side}
			canrecruit=yes
		[/filter]
		[object]
			silent=yes
			{CW_EFFECT_HEAL}
			{CW_EFFECT_CURE}
			{CW_EFFECT_UNSLOW}
		[/object]
		[if]
			[variable]
				name=second_unit.side
				equals={enemy1}
			[/variable]
			[or]
				[variable]
					name=second_unit.side
					equals={enemy2}
				[/variable]
			[/or]
			[or]
				[variable]
					name=second_unit.side
					equals={creepside1}
				[/variable]
			[/or]
			[then]
				[gold]
					side={enemy1}
					amount=20
				[/gold]
				[gold]
					side={enemy2}
					amount=20
				[/gold]
				[set_variable]
					name=gold_{team1}
					add=20
				[/set_variable]
				[set_variable]
					name={kill1}
					add=3
				[/set_variable]
				[gold]
					side={enemy3}
					amount=10
				[/gold]
				[gold]
					side={enemy2}
					amount=10
				[/gold]
				[set_variable]
					name=gold_{team2}
					add=10
				[/set_variable]
				[set_variable]
					name={kill2}
					add=1.5
				[/set_variable]
				[object]
					silent=yes
					[filter]
						id=CW_Guard_{team1}1
					[/filter]
					[effect]
						apply_to=hitpoints
						increase_total=3
						increase=3
					[/effect]
				[/object]
				[object]
					silent=yes
					[filter]
						id=CW_Guard_{team1}2
					[/filter]
					[effect]
						apply_to=hitpoints
						increase_total=3
						increase=3
					[/effect]
				[/object]
				[set_variable]
					name=guard_{team1}_plus_hitpoints
					add=3
				[/set_variable]
				[object]
					silent=yes
					[filter]
						id=CW_Guard_{team2}1
					[/filter]
					[effect]
						apply_to=hitpoints
						increase_total=1
						increase=1
					[/effect]
				[/object]
				[object]
					silent=yes
					[filter]
						id=CW_Guard_{team2}2
					[/filter]
					[effect]
						apply_to=hitpoints
						increase_total=1
						increase=1
					[/effect]
				[/object]
				[set_variable]
					name=guard_{team2}_plus_hitpoints
					add=1
				[/set_variable]
				{frac_add_hp_guard {kill2} {team2}}
			[/then]
		[/if]
		[if]
			[variable]
				name=second_unit.side
				equals={enemy3}
			[/variable]
			[or]
				[variable]
					name=second_unit.side
					equals={enemy4}
				[/variable]
			[/or]
			[or]
				[variable]
					name=second_unit.side
					equals={creepside2}
				[/variable]
			[/or]
			[then]
				[gold]
					side={enemy3}
					amount=20
				[/gold]
				[gold]
					side={enemy4}
					amount=20
				[/gold]
				[set_variable]
					name=gold_{team2}
					add=20
				[/set_variable]
				[set_variable]
					name={kill2}
					add=3
				[/set_variable]
				[gold]
					side={enemy1}
					amount=10
				[/gold]
				[gold]
					side={enemy2}
					amount=10
				[/gold]
				[set_variable]
					name=gold_{team1}
					add=10
				[/set_variable]
				[set_variable]
					name={kill1}
					add=1.5
				[/set_variable]
				[object]
					silent=yes
					[filter]
						id=CW_Guard_{team2}1
					[/filter]
					[effect]
						apply_to=hitpoints
						increase_total=3
						increase=3
					[/effect]
				[/object]
				[object]
					silent=yes
					[filter]
						id=CW_Guard_{team2}2
					[/filter]
					[effect]
						apply_to=hitpoints
						increase_total=3
						increase=3
					[/effect]
				[/object]
				[set_variable]
					name=guard_{team2}_plus_hitpoints
					add=3
				[/set_variable]
				[object]
					silent=yes
					[filter]
						id=CW_Guard_{team1}1
					[/filter]
					[effect]
						apply_to=hitpoints
						increase_total=1
						increase=1
					[/effect]
				[/object]
				[object]
					silent=yes
					[filter]
						id=CW_Guard_{team1}2
					[/filter]
					[effect]
						apply_to=hitpoints
						increase_total=1
						increase=1
					[/effect]
				[/object]
				[set_variable]
					name=guard_{team1}_plus_hitpoints
					add=1
				[/set_variable]
				{frac_add_hp_guard {kill1} {team1}}
			[/then]
		[/if]
		[store_unit]
			[filter]
				side={side}
				canrecruit=yes
			[/filter]
			variable=dead_hero_{side}
			kill=yes
		[/store_unit]
		[set_variable]
			name=hero_{side}
			value=dead
		[/set_variable]
		{CW_UPDATE_SCORE}
	[/event]
#enddef

#define CW_MIRROR_REPLACE_3
# Spearman is the error prevention unit
	{CW_STORE_HERO_T mirror "Fog Clearer" 1,5 yes}
	{FOREACH mirror i}
		{CW_RANDOM_UNIT_VAR}
		{CW_UNIT $my_unit $mirror[$i].id $mirror[$i].name $mirror[$i].side $mirror[$i].canrecruit $mirror[$i].x $mirror[$i].y}
	{NEXT i}

	{CW_STORE_HERO clonable1 1 no}
	{CW_STORE_HERO clonable5 5 no}

	{CW_MIRROR_REPLACE_IF 1 4}
	{CW_MIRROR_REPLACE_IF 1 7}
	{CW_MIRROR_REPLACE_IF 5 2}
	{CW_MIRROR_REPLACE_IF 5 8}
#enddef

#define CW_GET_THIRD_TEAM_FROM_SIDES TEAM NOT_SIDE_1 NOT_SIDE_2
	{CW_GET_TEAM_FROM_SIDE team1 {NOT_SIDE_1}}
	{CW_GET_TEAM_FROM_SIDE team2 {NOT_SIDE_2}}
	[store_side]
		variable=temp_sides
		side={CW_PLAYER_SIDES}
		[not]
			team_name=$team1
			[or]
				team_name=$team2
				[/or]
			[/not]
		[/store_side]
	{VARIABLE {TEAM} $temp_sides[0].team_name}
	{CLEAR_VARIABLE temp_sides,team1,team2}
#enddef

#define CW_ADD_THIRD_TEAM_SCORE NOT_SIDE_1 NOT_SIDE_2 SCORE
	[if]
		{VARIABLE_CONDITIONAL cw_teams_alive greater_than_equal_to 3}
		[then]
			{CW_GET_THIRD_TEAM_FROM_SIDES third_team {NOT_SIDE_1} {NOT_SIDE_2}}
			[set_variable]
				name=temp_score_frac
				fpart={SCORE}
				[/set_variable]
			{VARIABLE_OP cw_kills_$third_team add {SCORE}}
			[if]
				{VARIABLE_CONDITIONAL temp_score_frac greater_than 0}
				[then]
					[set_variable]
						name=temp_score_int
						ipart={SCORE}
						[/set_variable]
					{CW_UNIT_GUARD_INCREASE_HP $third_team 1 $temp_score_int}
					{CW_UNIT_GUARD_INCREASE_HP $third_team 2 $temp_score_int}
					{CW_ADD_FRAC_HP $third_team 1 $temp_score_frac}
					{CW_ADD_FRAC_HP $third_team 2 $temp_score_frac}
					{CLEAR_VARIABLE temp_score_int}
					[/then]
				[else]
					{CW_UNIT_GUARD_INCREASE_HP $third_team 1 {SCORE}}
					{CW_UNIT_GUARD_INCREASE_HP $third_team 2 {SCORE}}
					[/else]
				[/if]
			{CLEAR_VARIABLE third_team,temp_score_frac}
			[/then]
		[/if]
#enddef

#define CW_ADD_FRAC_HP TEAM GUARD_NUM AMOUNT
	{VARIABLE temp_team {TEAM}}
	[store_unit]
		[filter]
			id=CW_Guard_$temp_team|{GUARD_NUM}
			[/filter]
		variable=temp_guard
		[/store_unit]
	{VARIABLE_OP temp_guard.variables.hp_frac add {AMOUNT}}
	[if]
		{VARIABLE_CONDITIONAL temp_guard.variables.hp_frac greater_than_equal_to 1}
		[then]
			{VARIABLE_OP temp_guard.variables.hp_frac sub 1}
			{VARIABLE_OP temp_guard.max_hitpoints add 1}
			{VARIABLE_OP temp_guard.hitpoints add 1}
			[/then]
		[/if]
	[unstore_unit]
		variable=temp_guard
		[/unstore_unit]
	{CLEAR_VARIABLE temp_team,temp_guard}
#enddef

#endif		#end ifdef CW_USE_THREE_TEAMS
