#textdomain wesnoth-creep_war

#define CW_HERO_SET_START_POS SIDE LIMBO_X_POS LIMBO_Y_POS HOME_X_POS HOME_Y_POS
	[store_unit]
		[filter]
			side={SIDE}
			canrecruit=yes
			[/filter]
		variable=hero
		[/store_unit]
	{VARIABLE hero.variables.location (limbo)}
	{VARIABLE hero.variables.limbo.x {LIMBO_X_POS}}
	{VARIABLE hero.variables.limbo.y {LIMBO_Y_POS}}
	{VARIABLE hero.variables.home.x {HOME_X_POS}}
	{VARIABLE hero.variables.home.y {HOME_Y_POS}}
	[unstore_unit]
		variable=hero
		[/unstore_unit]
	{CLEAR_VARIABLE hero}
#enddef

#define CW_EVENT_HERO_DIE
	[event]
		name=die
		first_time_only=no
		[filter]
			side={CW_PLAYER_SIDES}
			canrecruit=yes
			[/filter]
		[object]
			silent=yes
			{CW_EFFECT_HEAL}
			{CW_EFFECT_CURE}
			{CW_EFFECT_UNSLOW}
			[/object]
		{VARIABLE hero_$unit.side killed}
		{CW_STORE_HERO temp_hero $unit.side yes}
		[unstore_unit]
			variable=temp_hero
			x=$temp_hero.variables.limbo.x
			y=$temp_hero.variables.limbo.y
			[/unstore_unit]
		{CW_SCORE_ADD_FROM_SIDE $second_unit.side  3}
		{CW_GOLD_ADD_FROM_SIDE  $second_unit.side 20}
#ifdef CW_USE_THREE_TEAMS
		[if]
			{VARIABLE_CONDITIONAL cw_teams_alive greater_than_equal_to 3}
			[then]
				{CW_GET_THIRD_TEAM_FROM_SIDES third_team $unit.side $second_unit.side}
				{CW_ADD_THIRD_TEAM_SCORE $third_team 1.5}
				{CW_GOLD_ADD_FROM_TEAM $third_team 10}
				{CLEAR_VARIABLE third_team}
				[/then]
			[/if]
#endif
		{CW_UPDATE_SCORE}
		{CLEAR_VARIABLE temp_hero}
	[/event]
#enddef

#define CW_EVENT_TELEPORT_FROM_START
		#implement side filter
[event]
	name=side turn
	first_time_only=no
	[filter_side]
		side={CW_PLAYER_SIDES}
		[/filter_side]
	{CW_STORE_HERO temp_hero $side_number no}
	[switch]
		variable=hero_$side_number
			{CW_SCASE limbo (
				{CW_COMMAND_TELEPORT_HERO temp_hero home}
				{VARIABLE hero_$side_number alive})}
			{CW_SCASE killed (
				{VARIABLE hero_$side_number limbo}
				[end_turn]
					[/end_turn])}
		[/switch]
	{CLEAR_VARIABLE temp_hero}
	[/event]
#enddef

#define CW_COMMAND_TELEPORT_HERO UNIT DESTINATION
## Destination is home or limbo
	[teleport]
		{CW_FILTER_HERO ${UNIT}.side}
		x=${UNIT}.variables.{DESTINATION}.x
		y=${UNIT}.variables.{DESTINATION}.y
		[/teleport]
#enddef