#textdomain wesnoth-creep_war

#define CW_SHOP_LOAD MODULENAME
	{~add-ons/Creep_War/shop/{MODULENAME}.cfg}
#enddef

{CW_SHOP_LOAD shop_template}
{CW_SHOP_LOAD menu_hero}
{CW_SHOP_LOAD menu_guard}
{CW_SHOP_LOAD shield}
{CW_SHOP_LOAD resistance}
{CW_SHOP_LOAD weapon}

#ifdef CW_SHOP_USE_BANK
	{CW_SHOP_LOAD menu_bank}
#endif
#ifdef CW_USE_TEAMLEADER
	{CW_SHOP_LOAD menu_teamleader}
#endif


#define CW_SHOP SHOP_POS_X1 SHOP_POS_X2 SHOP_POS_Y1 SHOP_POS_Y2 TEAM CREEP_SIDE CW_GUARD1_POS_X CW_GUARD1_POS_Y CW_GUARD2_POS_X CW_GUARD2_POS_Y UNIT_GUARD1 UNIT_GUARD2 SIDE
	[set_menu_item]
		id=Ashop{SIDE}
		description= _ "Enter Shop"
		[filter_location]
			x={SHOP_POS_X1},{SHOP_POS_X2}
			y={SHOP_POS_Y1},{SHOP_POS_Y2}
		[/filter_location]
		[show_if]
			[have_unit]
				side={SIDE}
				canrecruit=yes			# If you have acquired more units through plague, they can't visit the shop
				x=$x1
				y=$y1
			[/have_unit]
			[variable]
				name=side_number
				equals={SIDE}
			[/variable]
		[/show_if]
##	Heal and cure upon visit to shop
		[command]
			[object]
				silent=yes
				[effect]
					apply_to=hitpoints
					heal_full=yes
				[/effect]
				[effect]
					apply_to=status
					remove=poisoned
				[/effect]
			[/object]
##	End Heal and Cure
			[set_variable]
				name=main_menu_finished
				value=no
			[/set_variable]
			[while]
				[variable]
					name=main_menu_finished
					equals=no
				[/variable]
				[do]
					[redraw]
					[/redraw]
					[store_gold]
						side=$side_number
						variable=gold
					[/store_gold]
					[message]
						speaker=narrator
						side_for={SIDE}
						message=_ "Your gold: $gold|"
						[option]
							message=_ "Close menu"
							[command]
								[set_variable]
									name=main_menu_finished
									value=yes
								[/set_variable]
							[/command]
						[/option]
						[option]
							message=_ " "
						[/option]
## Training Menu
	{CW_SHOP_MENU_HERO {SIDE} main}
## New Weapons Menu
						[option]
							message= _ {MENU_IMG_TXT "icons/crossed_sword_and_hammer.png" "Buy weapons"}
							[command]
								[set_variable]
									name=main_menu_finished
									value=yes
								[/set_variable]
								[set_variable]
									name=shop
									value=no
								[/set_variable]
								[while]
									[variable]
										name=shop
										equals=no
									[/variable]
									[do]
										[redraw]
										[/redraw]
										[store_gold]
											side=$side_number
											variable=gold
										[/store_gold]
										[message]
											speaker=narrator
											side_for={SIDE}
											message=_ "Your gold: $gold|"
											[option]
												message=_ "Back"
												[command]
													[set_variable]
														name=shop
														value=yes
													[/set_variable]
													[set_variable]
														name=main_menu_finished
														value=no
													[/set_variable]
												[/command]
											[/option]
											[option]
												message=_ " "
											[/option]
											{CW_SHOP_NEW_WEAPON dagger "9-1 melee, blade, backstab" "attacks/dagger-human.png" 35 {SIDE} 1 (
	[effect]
		apply_to=new_attack
		name=dagger
		description= _ "dagger"
		[specials]
			{WEAPON_SPECIAL_BACKSTAB}
		[/specials]
		type=blade
		icon=attacks/dagger-human.png
		range=melee
		damage=9
		number=1
	[/effect]
	[effect]
		apply_to=new_animation
		[attack_anim]
			[filter_attack]
				name=dagger
			[/filter_attack]
			start_time=-25
			[if]
				hits=yes
				[frame]
					duration=35
					sound=dagger-swish.wav
				[/frame]
			[/if]
			[else]
				hits=no
				[frame]
					duration=35
					sound={SOUND_LIST:MISS}
				[/frame]
			[/else]
		[/attack_anim]
	[/effect]
	[effect]
		apply_to=attack
		name=dagger
		increase_damage=$damage_melee_{SIDE}
		increase_attacks=$strikes_melee_{SIDE}
	[/effect])}
											{CW_SHOP_NEW_WEAPON short-sword "6-3 melee, blade" "attacks/sword-human-short.png" 35 {SIDE} 2 (
	[effect]
		apply_to=new_attack
		name=short-sword
		description= _ "short-sword"
		type=blade
		icon=attacks/sword-human-short.png
		range=melee
		damage=6
		number=3
	[/effect]
	[effect]
		apply_to=new_animation
		[attack_anim]
			[filter_attack]
				name=short-sword
			[/filter_attack]
			start_time=-150
			[if]
				hits=yes
				[frame]
					duration=200
					image="units/human-loyalists/swordsman-attack-2.png"
					sound={SOUND_LIST:SWORD_SWISH}
				[/frame]
			[/if]
			[else]
				hits=no
				[frame]
					duration=200
					image="units/human-loyalists/swordsman-attack-2.png"
					sound={SOUND_LIST:MISS}
				[/frame]
			[/else]
		[/attack_anim]
	[/effect]
	[effect]
		apply_to=attack
		name=short-sword
		increase_damage=$damage_melee_{SIDE}
		increase_attacks=$strikes_melee_{SIDE}
	[/effect])}
											{CW_SHOP_NEW_WEAPON mace "9-2 melee, impact" "attacks/mace.png" 35 {SIDE} 3 (
	[effect]
		apply_to=new_attack
		name=mace
		description= _ "mace"
		type=impact
		icon=attacks/mace.png
		range=melee
		damage=9
		number=2
	[/effect]
	[effect]
		apply_to=new_animation
		[attack_anim]
			[filter_attack]
				name=mace
			[/filter_attack]
			start_time=-200
			[if]
				hits=yes
				[frame]
					duration=400
					sound=mace.wav
				[/frame]
			[/if]
			[else]
				hits=no
				[frame]
					duration=400
					sound={SOUND_LIST:MISS}
				[/frame]
			[/else]
		[/attack_anim]
	[/effect]
	[effect]
		apply_to=attack
		name=mace
		increase_damage=$damage_melee_{SIDE}
		increase_attacks=$strikes_melee_{SIDE}
	[/effect])}
											{CW_SHOP_NEW_WEAPON arcane-sword "6-3 melee, arcane" "attacks/sword-holy.png" 40 {SIDE} 4 (
	[effect]
		apply_to=new_attack
		name=arcane-sword
		description= _ "arcane-sword"
		type=arcane
		icon=attacks/sword-holy.png
		range=melee
		damage=6
		number=3
	[/effect]
	[effect]
		apply_to=new_animation
		[attack_anim]
			[filter_attack]
				name=arcane-sword
			[/filter_attack]
			start_time=-225
			[if]
				hits=yes
				[frame]
					duration=300
					sound={SOUND_LIST:SWORD_SWISH}
				[/frame]
			[/if]
			[else]
				hits=no
				[frame]
					duration=300
					sound={SOUND_LIST:MISS}
				[/frame]
			[/else]
		[/attack_anim]
	[/effect]
	[effect]
		apply_to=attack
		name=arcane-sword
		increase_damage=$damage_melee_{SIDE}
		increase_attacks=$strikes_melee_{SIDE}
	[/effect])}
											{CW_SHOP_NEW_WEAPON torch "6-3 melee, fire" "attacks/torch.png" 40 {SIDE} 5 (
	[effect]
		apply_to=new_attack
		name=torch
		description= _ "torch"
		type=fire
		icon=attacks/torch.png
		range=melee
		damage=6
		number=3
	[/effect]
	[effect]
		apply_to=new_animation
		[attack_anim]
			[filter_attack]
				name=torch
			[/filter_attack]
			start_time=-200
			[if]
				hits=yes
				[frame]
					duration=300
			  		sound=torch.ogg
				[/frame]
			[/if]
			[else]
				hits=no
				[frame]
					duration=300
			   		sound=torch-miss.ogg
				[/frame]
			[/else]
		[/attack_anim]
	[/effect]
	[effect]
		apply_to=attack
		name=torch
		increase_damage=$damage_melee_{SIDE}
		increase_attacks=$strikes_melee_{SIDE}
	[/effect])}
											{CW_SHOP_NEW_WEAPON spear (6-2 melee, pierce, firststrike
5-1 ranged, pierce) "attacks/spear.png" 35 {SIDE} 6 (
	[effect]
		apply_to=new_attack
		name=spear
		type=pierce
		description= _ "spear"
		[specials]
			  {WEAPON_SPECIAL_FIRSTSTRIKE}
		[/specials]
		icon=attacks/spear.png
		range=melee
		damage=6
		number=2
	[/effect]
	[effect]
		apply_to=new_animation
		[attack_anim]
			[filter_attack]
				name=spear
			[/filter_attack]
			start_time=-200
			[if]
				hits=yes
				[frame]
					duration=300
					sound=spear.ogg
				[/frame]
			[/if]
			[else]
				hits=no
				[frame]
					duration=300
					sound=spear-miss.ogg
				[/frame]
			[/else]
		[/attack_anim]
	[/effect]
	[effect]
		apply_to=new_attack
		name=javelin
		type=pierce
		description= _ "javelin"
		icon=attacks/javelin-human.png
		range=ranged
		damage=5
		number=1
	[/effect]
	[effect]
		apply_to=new_animation
		[attack_anim]
			[filter_attack]
				name=javelin
			[/filter_attack]
			start_time=-350
			missile_start_time=-150
			[missile_frame]
				duration=150
				image="projectiles/spear-n.png"
				image_diagonal="projectiles/spear-ne.png"
			[/missile_frame]
			[frame]
				duration=150
				image="units/human-loyalists/spearman-death1.png"
				sound={SOUND_LIST:THROW}
			[/frame]
			[if]
				hits=yes
				[frame]
					duration=100
					sound=spear.ogg
				[/frame]
			[/if]
			[else]
				hits=no
				[frame]
					duration=100
				[/frame]
			[/else]
		[/attack_anim]
	[/effect]
	[effect]
		apply_to=attack
		name=spear
		increase_damage=$damage_melee_{SIDE}
		increase_attacks=$strikes_melee_{SIDE}
	[/effect]
	[effect]
		apply_to=attack
		name=javelin
		increase_damage=$damage_ranged_{SIDE}
		increase_attacks=$strikes_ranged_{SIDE}
	[/effect])}
											{CW_SHOP_NEW_WEAPON thunderstick "15-1 ranged, pierce" "attacks/thunderstick.png" 40 {SIDE} 7 (
	[effect]
		apply_to=new_attack
		name=thunderstick
		description= _ "thunderstick"
		type=pierce
		icon=attacks/thunderstick.png
		range=ranged
		damage=15
		number=1
	[/effect]
	[effect]
		apply_to=new_animation
		[attack_anim]
			[filter_attack]
				name=thunderstick
			[/filter_attack]
			start_time=-400
			missile_start_time=-150
			[if]
				{MISSILE_FRAME_MUZZLE_FLARE_HIT_SOUTH 0 0}
				direction=s
				hits=yes
				[frame]
					duration=400
					sound=thunderstick.ogg
				[/frame]
			[/if]
			[else]
				{MISSILE_FRAME_MUZZLE_FLARE_MISS}
				direction=s
				hits=no
				[frame]
					duration=400
					sound=thunderstick-miss.ogg
				[/frame]
			[/else]
			[else]
				{MISSILE_FRAME_MUZZLE_FLARE_HIT_DIAG_NORTH 0 20}
				direction=ne,nw
				hits=yes
				[frame]
					duration=400
					sound=thunderstick.ogg
				[/frame]
			[/else]
			[else]
				{MISSILE_FRAME_MUZZLE_FLARE_MISS}
				direction=ne,nw
				hits=no
				[frame]
					duration=400
					sound=thunderstick-miss.ogg
				[/frame]
			[/else]
			[else]
				{MISSILE_FRAME_MUZZLE_FLARE_HIT_NORTH 0 20}
				direction=n
				hits=yes
				[frame]
					duration=400
					sound=thunderstick.ogg
				[/frame]
			[/else]
			[else]
				{MISSILE_FRAME_MUZZLE_FLARE_MISS}
				direction=n
				hits=no
				[frame]
					duration=400
					sound=thunderstick-miss.ogg
				[/frame]
			[/else]
			[else]
				{MISSILE_FRAME_MUZZLE_FLARE_HIT_DIAG_SOUTH 0 0}
				direction=se,sw
				hits=yes
				[frame]
					duration=400
					sound=thunderstick.ogg
				[/frame]
			[/else]
			[else]
				{MISSILE_FRAME_MUZZLE_FLARE_MISS}
				direction=se,sw
				hits=no
				[frame]
					duration=400
					sound=thunderstick-miss.ogg
				[/frame]
			[/else]
		[/attack_anim]
	[/effect]
	[effect]
		apply_to=attack
		name=thunderstick
		increase_damage=$damage_ranged_{SIDE}
		increase_attacks=$strikes_ranged_{SIDE}
	[/effect])}
											{CW_SHOP_NEW_WEAPON bow (5-3 ranged, pierce
5-2 ranged, fire) "attacks/bow.png" 35 {SIDE} 8 (
	[effect]
		apply_to=new_attack
		name=bow
		description= _ "bow"
		type=pierce
		icon=attacks/bow.png
		range=ranged
		damage=5
		number=3
	[/effect]
	[effect]
		apply_to=new_animation
		[attack_anim]
			[filter_attack]
				name=bow
			[/filter_attack]
			start_time=-350
			missile_start_time=-150
			[missile_frame]
					duration=150
				image="projectiles/missile-n.png"
				image_diagonal="projectiles/missile-ne.png"
			[/missile_frame]
			[if]
				hits=no
				[frame]
					duration=75
					sound=bow-miss.ogg
				[/frame]
			[/if]
			[else]
				hits=yes
				[frame]
					duration=75
					sound=bow.ogg
				[/frame]
			[/else]
		[/attack_anim]
	[/effect]
	[effect]
		apply_to=new_attack
		name=fire bow
		description= _ "fire bow"
		type=fire
		icon=attacks/bow.png
		range=ranged
		damage=5
		number=2
	[/effect]
	[effect]
		apply_to=new_animation
		[attack_anim]
			[filter_attack]
				name=fire bow
			[/filter_attack]
			start_time=-350
			missile_start_time=-150
			[if]
				hits=no
				[missile_frame]
					duration=150
					image="projectiles/missile-fire-n.png"
					image_diagonal="projectiles/missile-fire-ne.png"
				[/missile_frame]
				[frame]
					duration=100
					sound=bow-puny-fire-miss.ogg
				[/frame]
			[/if]
			[else]
				hits=yes
				[missile_frame]
					duration=150
					image="projectiles/missile-fire-n.png"
					image_diagonal="projectiles/missile-fire-ne.png"
					offset=0~0.8
				[/missile_frame]
				{FIRE_BURST_SMALL}
				[frame]
					duration=100
					sound=bow-puny-fire.ogg
				[/frame]
			[/else]
		[/attack_anim]
	[/effect]
	[effect]
		apply_to=attack
		name=bow
		increase_damage=$damage_ranged_{SIDE}
		increase_attacks=$strikes_ranged_{SIDE}
	[/effect]
	[effect]
		apply_to=attack
		name=fire bow
		increase_damage=$damage_ranged_{SIDE}
		increase_attacks=$strikes_ranged_{SIDE}
	[/effect])}
											{CW_SHOP_NEW_WEAPON crossbow (7-3 ranged, pierce
7-2 ranged, fire) "attacks/crossbow-human.png" 40 {SIDE} 9 (
	[effect]
		apply_to=new_attack
		name=crossbow
		description= _ "crossbow"
		type=pierce
		icon=attacks/crossbow-human.png
		range=ranged
		damage=7
		number=3
	[/effect]
	[effect]
		[attack_anim]
			[filter_attack]
				name=crossbow
				type=pierce
			[/filter_attack]
			start_time=-300
			missile_start_time=-150
			[missile_frame]
					duration=150
				image="projectiles/missile-n.png"
				image_diagonal="projectiles/missile-ne.png"
			[/missile_frame]
			[if]
				hits=yes
				[frame]
					duration=150
					sound=crossbow.ogg
				[/frame]
			[/if]
			[else]
				hits=no
				[frame]
					duration=150
					sound=crossbow-miss.ogg
				[/frame]
			[/else]
		[/attack_anim]
	[/effect]
	[effect]
		apply_to=new_attack
		name=fire crossbow
		description= _ "fire crossbow"
		type=fire
		icon=attacks/crossbow-human.png
		range=ranged
		damage=7
		number=2
	[/effect]
	[effect]
		apply_to=new_animation
		[attack_anim]
			[filter_attack]
				name=fire crossbow
			[/filter_attack]
			start_time=-300
			missile_start_time=-150
			[if]
				hits=no
				[missile_frame]
					duration=150
					image="projectiles/missile-fire-n.png"
					image_diagonal="projectiles/missile-fire-ne.png"
				[/missile_frame]
				[frame]
					duration=100
					sound=crossbow-fire-miss.ogg
				[/frame]
			[/if]
			[else]
				hits=yes
				[missile_frame]
					begin=-150
					end=0
					image="projectiles/missile-fire-n.png"
					image_diagonal="projectiles/missile-fire-ne.png"
					offset=0~0.8
				[/missile_frame]
				{FIRE_BURST_SMALL}
				[frame]
					duration=100
					sound=crossbow-fire.ogg
				[/frame]
			[/else]
		[/attack_anim]
	[/effect]
	[effect]
		apply_to=attack
		name=crossbow
		increase_damage=$damage_ranged_{SIDE}
		increase_attacks=$strikes_ranged_{SIDE}
	[/effect]
	[effect]
		apply_to=attack
		name=fire crossbow
		increase_damage=$damage_ranged_{SIDE}
		increase_attacks=$strikes_ranged_{SIDE}
	[/effect])}
											{CW_SHOP_NEW_WEAPON longbow (6-3 ranged, pierce, marksman
6-2 ranged, fire, marksman) "attacks/bow-elven-magic.png" 45 {SIDE} 10 (
	[effect]
		apply_to=new_attack
		name=longbow
		type=pierce
		[specials]
			{WEAPON_SPECIAL_MARKSMAN}
		[/specials]
		icon=attacks/bow-elven-magic.png
		range=ranged
		damage=6
		number=3
	[/effect]
	[effect]
		apply_to=new_animation
		[attack_anim]
			[filter_attack]
				name=longbow
			[/filter_attack]
			start_time=-350
			missile_start_time=-150
			[missile_frame]
					duration=150
				image="projectiles/missile-n.png"
				image_diagonal="projectiles/missile-ne.png"
			[/missile_frame]
			[if]
				hits=no
				[frame]
					duration=75
					sound=bow-miss.ogg
				[/frame]
			[/if]
			[else]
				hits=yes
				[frame]
					duration=75
					sound=bow.ogg
				[/frame]
			[/else]
		[/attack_anim]
	[/effect]
	[effect]
		apply_to=new_attack
		name=fire longbow
		type=fire
		[specials]
			{WEAPON_SPECIAL_MARKSMAN}
		[/specials]
		icon=attacks/bow-elven-magic.png
		range=ranged
		damage=6
		number=2
	[/effect]
	[effect]
		apply_to=new_animation
		[attack_anim]
			[filter_attack]
				name=fire longbow
			[/filter_attack]
			start_time=-350
			missile_start_time=-150
			[if]
				hits=no
				[missile_frame]
					duration=150
					image="projectiles/missile-fire-n.png"
					image_diagonal="projectiles/missile-fire-ne.png"
				[/missile_frame]
				[frame]
					duration=100
					sound=bow-puny-fire-miss.ogg
				[/frame]
			[/if]
			[else]
				hits=yes
				[missile_frame]
					duration=150
					image="projectiles/missile-fire-n.png"
					image_diagonal="projectiles/missile-fire-ne.png"
					offset=0~0.8
				[/missile_frame]
				{FIRE_BURST_SMALL}
				[frame]
					duration=100
					sound=bow-puny-fire.ogg
				[/frame]
			[/else]
		[/attack_anim]
	[/effect]
	[effect]
		apply_to=attack
		name=longbow
		increase_damage=$damage_ranged_{SIDE}
		increase_attacks=$strikes_ranged_{SIDE}
	[/effect]
	[effect]
		apply_to=attack
		name=fire longbow
		increase_damage=$damage_ranged_{SIDE}
		increase_attacks=$strikes_ranged_{SIDE}
	[/effect])}
											{CW_SHOP_NEW_WEAPON "net" (4-2 ranged, impact, slow) "attacks/net.png" 45 {SIDE} 11 (
	[effect]
		apply_to=new_attack
		name=net
		description= _ "net"
		type=impact
		[specials]
			{WEAPON_SPECIAL_SLOW}
		[/specials]
		icon=attacks/net.png
		range=ranged
		damage=4
		number=2
	[/effect]
	[effect]
		apply_to=new_animation
		[attack_anim]
			[filter_attack]
				name=net
			[/filter_attack]
			start_time=-150
			missile_start_time=-200
			[missile_frame]
				duration=200
				image="projectiles/web.png"
				image_diagonal="projectiles/web.png"
			[/missile_frame]
			[if]
				hits=yes
				[frame]
					duration=75
					sound=net.wav
				[/frame]
			[/if]
			[else]
				hits=no
				[frame]
					duration=75
					sound={SOUND_LIST:MISS}
				[/frame]
			[/else]
			{SOUND:SLOW}
		[/attack_anim]
	[/effect]
	[effect]
		apply_to=attack
		name=net
		increase_damage=$damage_ranged_{SIDE}
		increase_attacks=$strikes_ranged_{SIDE}
	[/effect])}
											{CW_SHOP_NEW_WEAPON "poisoned knife" (4-2 ranged, blade, poison) "attacks/dagger-thrown-poison-human.png" 45 {SIDE} 12 (
	[effect]
		apply_to=new_attack
		name=poisoned knife
		description= _ "poisoned knife"
		type=blade
		[specials]
			{WEAPON_SPECIAL_POISON}
		[/specials]
		icon=attacks/dagger-thrown-poison-human.png
		range=ranged
		damage=4
		number=2
	[/effect]
	[effect]
		apply_to=new_animation
		[attack_anim]
			[filter_attack]
				name=knife
			[/filter_attack]
			start_time=-350
			missile_start_time=-150
			[missile_frame]
				duration=150
				image="projectiles/dagger-n.png"
				image_diagonal="projectiles/dagger-ne.png"
			[/missile_frame]
			[if]
				hits=yes
				[frame]
					duration=250
					sound=throwing-knife.ogg
				[/frame]
			[/if]
			[else]
				hits=no
				[frame]
					duration=250
					sound=throwing-knife-miss.ogg
				[/frame]
			[/else]
			{SOUND:POISON}
		[/attack_anim]
	[/effect]
	[effect]
		apply_to=attack
		name=poisoned knife
		increase_damage=$damage_ranged_{SIDE}
		increase_attacks=$strikes_ranged_{SIDE}
	[/effect])}
											{CW_SHOP_NEW_WEAPON "fireball" (11-1 ranged, fire, magical) "attacks/fireball.png" 40 {SIDE} 13 (
	[effect]
		apply_to=new_attack
		name=fireball
		description= _ "fireball"
		type=fire
		[specials]
			{WEAPON_SPECIAL_MAGICAL}
		[/specials]
		icon=attacks/fireball.png
		range=ranged
		damage=11
		number=1
	[/effect]
	[effect]
		apply_to=new_animation
		[attack_anim]
			[filter_attack]
				name=fireball
			[/filter_attack]
			start_time=-525
			{MISSILE_FRAME_FIREBALL}
			[frame]
				duration=100
				sound=fire.wav
			[/frame]
		[/attack_anim]
	[/effect]
	[effect]
		apply_to=attack
		name=fireball
		increase_damage=$damage_ranged_{SIDE}
		increase_attacks=$strikes_ranged_{SIDE}
	[/effect])}
											{CW_SHOP_NEW_WEAPON "blizzard" (6-2 ranged, cold, magical) "attacks/iceball.png" 40 {SIDE} 14 (
	[effect]
		apply_to=new_attack
		name=blizzard
		description= _ "blizzard"
		type=cold
		[specials]
			{WEAPON_SPECIAL_MAGICAL}
		[/specials]
		icon=attacks/iceball.png
		range=ranged
		damage=6
		number=2
	[/effect]
	[effect]
		apply_to=new_animation
		[attack_anim]
			[filter_attack]
				name=blizzard
			[/filter_attack]
			start_time=-50
			missile_start_time=-50
			[missile_frame]
				begin=-50
				end=150
				image="projectiles/darkmissile-n.png"
				image_diagonal="projectiles/darkmissile-ne.png"
			[/missile_frame]
			[if]
				hits=yes
				[frame]
					duration=100
					sound=magic-dark.ogg
				[/frame]
			[/if]
			[else]
				hits=no
				[frame]
					duration=100
					sound=magic-dark-miss.ogg
				[/frame]
			[/else]
		[/attack_anim]
	[/effect]
	[effect]
		apply_to=attack
		name=blizzard
		increase_damage=$damage_ranged_{SIDE}
		increase_attacks=$strikes_ranged_{SIDE}
	[/effect])}
											{CW_SHOP_NEW_WEAPON "shield" (0-0 melee/ranged, shield 30%) "icons/shield_tower_merfolk.png" 40 {SIDE} 15 (
	[effect]
		apply_to=new_attack
		name=shield_melee
		description= _ "shield"
		[specials]
			{shield_30}
		[/specials]
		icon=icons/shield_tower_merfolk.png
		range=melee
		type=none
		attack_weight=0
		damage=0
		number=0
	[/effect]
	[effect]
		apply_to=new_attack
		name=shield_ranged
		description= _ "shield"
		[specials]
			{shield_30}
		[/specials]
		icon=icons/shield_tower_merfolk.png
		range=ranged
		type=none
		attack_weight=0
		damage=0
		number=0
	[/effect])}
										[/message]
									[/do]
								[/while]
							[/command]
						[/option]
						[option]
							message=_  {MENU_IMG_TXT "icons/cuirass_muscled.png" "Armor"}
							[command]
								[set_variable]
									name=main_menu_finished
									value=yes
								[/set_variable]
								[set_variable]
									name=armor_menu_finished
									value=no
								[/set_variable]
								[while]
									[variable]
										name=armor_menu_finished
										equals=no
									[/variable]
									[do]
										[redraw]
										[/redraw]
										[store_unit]
											[filter]
												x=$x1
												y=$y1
											[/filter]
											variable=resistance_store
										[/store_unit]
										{SET_VALUE resistance_arcane 100}
										{SET_VALUE resistance_blade 100}
										{SET_VALUE resistance_cold 100}
										{SET_VALUE resistance_fire 100}
										{SET_VALUE resistance_impact 100}
										{SET_VALUE resistance_pierce 100}
										{VARIABLE_OP resistance_arcane add -$resistance_store.resistance.arcane|}
										{VARIABLE_OP resistance_blade add -$resistance_store.resistance.blade|}
										{VARIABLE_OP resistance_cold add -$resistance_store.resistance.cold|}
										{VARIABLE_OP resistance_fire add -$resistance_store.resistance.fire|}
										{VARIABLE_OP resistance_impact add -$resistance_store.resistance.impact|}
										{VARIABLE_OP resistance_pierce add -$resistance_store.resistance.pierce|}
										[store_gold]
											side=$side_number
											variable=gold
										[/store_gold]
										[message]
											speaker=narrator
											side_for={SIDE}
											message=_ "Your gold: $gold|
<span size='small' weight='light'>Armor upgrades left: $allowed_armor_upgrades_{SIDE}|
arcane: $resistance_arcane|%
blade: $resistance_blade|%
cold: $resistance_cold|%
fire: $resistance_fire|%
impact: $resistance_impact|%
pierce: $resistance_pierce|%
</span>"
											[option]
												message=_ "Back"
												[command]
													[set_variable]
														name=armor_menu_finished
														value=yes
													[/set_variable]
													[set_variable]
														name=main_menu_finished
														value=no
													[/set_variable]
												[/command]
											[/option]
											[option]
												message=_ " "
											[/option]
											[option]
												message=_ {MENU_IMG_TXT "icons/cuirass_leather_studded.png" "<span color='#00FF00'>dwarven armor</span>
<span size='small' weight='light'>blade +20%
pierce +20%
impact +20%
fire +10%
cold +10%
arcane +0%</span>
<span size='small' weight='light'>upgrades cost: 8; 160 gold</span>"}
												[show_if]
														[variable]
															name=gold
															greater_than_equal_to=160
														[/variable]
														[variable]
															name=allowed_armor_upgrades_{SIDE}
															greater_than_equal_to=8
														[/variable]
												[/show_if]
												[command]
													[gold]
														side={SIDE}
														amount=-160
													[/gold]
													[set_variable]
														name=allowed_armor_upgrades_{SIDE}
														add=-8
													[/set_variable]
													[object]
														silent=yes
														[effect]
															apply_to=resistance
															[resistance]
																blade=-20
																cold=-10
																fire=-10
																impact=-20
																pierce=-20
															[/resistance]
														[/effect]
													[/object]
												[/command]
											[/option]
											[option]
												message=_ {MENU_IMG_TXT "icons/cuirass_leather_studded.png" "<span color='#FF0000'>dwarven armor</span>
<span size='small' weight='light'>blade +20%
pierce +20%
impact +20%
fire +10%
cold +10%
arcane +0%</span>
<span size='small' weight='light'>upgrades cost: 8; 160 gold</span>"}
												[show_if]
														[variable]
															name=gold
															less_than=160
														[/variable]
														[or]
															[variable]
																name=allowed_armor_upgrades_{SIDE}
																less_than=8
															[/variable]
														[/or]
												[/show_if]
											[/option]
											[option]
												message=_ {MENU_IMG_TXT "icons/cuirass_muscled.png" "<span color='#00FF00'>heavy dwarven armor</span>
<span size='small' weight='light'>blade +27%
pierce +23%
impact +23%
fire +12%
cold +12%
arcane +3%</span>
<span size='small' weight='light'>upgrades cost: 10; 200 gold</span>"}
												[show_if]
														[variable]
															name=gold
															greater_than_equal_to=200
														[/variable]
														[variable]
															name=allowed_armor_upgrades_{SIDE}
															greater_than_equal_to=10
														[/variable]
												[/show_if]
												[command]
													[gold]
														side={SIDE}
														amount=-200
													[/gold]
													[set_variable]
														name=allowed_armor_upgrades_{SIDE}
														add=-10
													[/set_variable]
													[object]
														silent=yes
														[effect]
															apply_to=resistance
															[resistance]
																blade=-27
																pierce=-23
																impact=-23
																fire=-12
																cold=-12
																arcane=-3
															[/resistance]
														[/effect]
													[/object]
												[/command]
											[/option]
											[option]
												message=_ {MENU_IMG_TXT "icons/cuirass_muscled.png" "<span color='#FF0000'>heavy dwarven armor</span>
<span size='small' weight='light'>blade +27%
pierce +23%
impact +23%
fire +12%
cold +12%
arcane +3%</span>
<span size='small' weight='light'>upgrades cost: 10; 200 gold</span>"}
												[show_if]
														[variable]
															name=gold
															less_than=200
														[/variable]
														[or]

															[variable]
																name=allowed_armor_upgrades_{SIDE}
																less_than=10
															[/variable]
														[/or]
												[/show_if]
											[/option]
											[option]
												message=_ {MENU_IMG_TXT "icons/cloak_leather_brown.png" "<span color='#00FF00'>robe of a Silver Mage</span>
<span size='small' weight='light'>blade +0%
pierce +0%
impact +0%
fire +40%
cold +40%
arcane +20%</span>
<span size='small' weight='light'>upgrades cost: 10; 200 gold</span>"}
												[show_if]
														[variable]
															name=gold
															greater_than_equal_to=200
														[/variable]
														[variable]
															name=allowed_armor_upgrades_{SIDE}
															greater_than_equal_to=10
														[/variable]
												[/show_if]
												[command]
													[gold]
														side={SIDE}
														amount=-200
													[/gold]
													[set_variable]
														name=allowed_armor_upgrades_{SIDE}
														add=-10
													[/set_variable]
													[object]
														silent=yes
														[effect]
															apply_to=resistance
															[resistance]
																fire=-40
																cold=-40
																arcane=-20
															[/resistance]
														[/effect]
													[/object]
												[/command]
											[/option]
											[option]
												message=_ {MENU_IMG_TXT "icons/cloak_leather_brown.png" "<span color='#FF0000'>robe of a Silver Mage</span>
<span size='small' weight='light'>blade +0%
pierce +0%
impact +0%
fire +40%
cold +40%
arcane +20%</span>
<span size='small' weight='light'>upgrades cost: 10; 200 gold</span>"}
												[show_if]
														[variable]
															name=gold
															less_than=200
														[/variable]
														[or]
															[variable]
																name=allowed_armor_upgrades_{SIDE}
																less_than=10
															[/variable]
														[/or]
												[/show_if]
											[/option]
											[option]
												message=_ {MENU_IMG_TXT "icons/breastplate.png" "<span color='#00FF00'>heavy human armor</span>
<span size='small' weight='light'>blade +35%
pierce +35%
impact +20%
fire -10%
cold -10%
arcane +10%</span>
<span size='small' weight='light'>upgrades cost: 8; 160 gold</span>"}
												[show_if]
														[variable]
															name=gold
															greater_than_equal_to=160
														[/variable]
														[variable]
															name=allowed_armor_upgrades_{SIDE}
															greater_than_equal_to=8
														[/variable]
												[/show_if]
												[command]
													[gold]
														side={SIDE}
														amount=-160
													[/gold]
													[set_variable]
														name=allowed_armor_upgrades_{SIDE}
														add=-8
													[/set_variable]
													[object]
														silent=yes
														[effect]
															apply_to=resistance
															[resistance]
																blade=-35
																pierce=-35
																impact=-20
																fire=10
																cold=10
																arcane=-10
															[/resistance]
														[/effect]
													[/object]
												[/command]
											[/option]
											[option]
												message=_ {MENU_IMG_TXT "icons/breastplate.png" "<span color='#FF0000'>heavy human armor</span>
<span size='small' weight='light'>blade +35%
pierce +35%
impact +20%
fire -10%
cold -10%
arcane +10%</span>
<span size='small' weight='light'>upgrades cost: 8; 160 gold</span>"}
												[show_if]
														[variable]
															name=gold
															less_than=160
														[/variable]
														[or]
															[variable]
																name=allowed_armor_upgrades_{SIDE}
																less_than=8
															[/variable]
														[/or]
												[/show_if]
											[/option]
		{CW_SHOP_ADD_RESISTANCE {SIDE} arcane 24 10}
		{CW_SHOP_ADD_RESISTANCE {SIDE} blade  24 10}
		{CW_SHOP_ADD_RESISTANCE {SIDE} cold   24 10}
		{CW_SHOP_ADD_RESISTANCE {SIDE} fire   24 10}
		{CW_SHOP_ADD_RESISTANCE {SIDE} impact 24 10}
		{CW_SHOP_ADD_RESISTANCE {SIDE} pierce 24 10}
										[/message]
									[/do]
								[/while]
							[/command]
						[/option]
#ifdef CW_SHOP_USE_BANK
	{CW_SHOP_MENU_BANK {SIDE}}
#endif

	{CW_SHOP_MENU_GUARD {SIDE} {TEAM} {UNIT_GUARD1} {UNIT_GUARD2} main guard {CREEP_SIDE}}

#ifdef CW_USE_TEAMLEADER
	{CW_SHOP_MENU_TEAMLEADER {SIDE} {TEAM}}
#endif
					[/message]
				[/do]
			[/while]
		[/command]
	[/set_menu_item]
#enddef
